<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BToDKTo3piK: CLTreeMaker.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>CLTreeMaker.cc</h1><a href="CLTreeMaker_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00004"></a>00004 <span class="keyword">using namespace </span>std;
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include "TCanvas.h"</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "TTree.h"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "TH3F.h"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "TRandom.h"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "TString.h"</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include "BToDKTo3piK/CLTreeMaker.hh"</span>
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="CLTreeMaker_8cc.html#f6583114a540344b427f747a3d7792f7">00014</a> <a class="code" href="Bdk2DpolyDalitz_8cc.html#cb934f5e4adb5983817626fa8e644a8c">ClassImp</a>(<a class="code" href="classCLTreeMaker.html">CLTreeMaker</a>)
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <a class="code" href="classCLTreeMaker.html">CLTreeMaker</a>::<a class="code" href="classCLTreeMaker.html">CLTreeMaker</a>(<span class="keywordtype">bool</span> bigTree,
<a name="l00017"></a>00017                          <span class="keywordtype">int</span> resolution,
<a name="l00018"></a>00018                          <span class="keywordtype">double</span> maxNDof,
<a name="l00019"></a>00019                          <span class="keywordtype">double</span> dataRhoN,
<a name="l00020"></a>00020                          <span class="keywordtype">double</span> dataThetaN,
<a name="l00021"></a>00021                          <span class="keywordtype">double</span> dataRhoP,
<a name="l00022"></a>00022                          <span class="keywordtype">double</span> dataThetaP,
<a name="l00023"></a>00023                          <span class="keywordtype">double</span> dataRhoErrN,
<a name="l00024"></a>00024                          <span class="keywordtype">double</span> dataRhoErrP,
<a name="l00025"></a>00025                          <span class="keywordtype">double</span> dataThetaErrN,
<a name="l00026"></a>00026                          <span class="keywordtype">double</span> dataThetaErrP) :
<a name="l00027"></a>00027   _bigTree(bigTree),
<a name="l00028"></a>00028 
<a name="l00029"></a>00029   <span class="comment">// parms for chi^2 integral calculation resolution:</span>
<a name="l00030"></a>00030   _resolution(resolution),
<a name="l00031"></a>00031   _maxNDof(maxNDof),
<a name="l00032"></a>00032   _chi2Step_4(maxNDof * 4 / resolution),
<a name="l00033"></a>00033 
<a name="l00034"></a>00034   <span class="comment">// The data results:</span>
<a name="l00035"></a>00035   _dataRhoN(dataRhoN),
<a name="l00036"></a>00036   _dataThetaN(dataThetaN),
<a name="l00037"></a>00037   _dataRhoP(dataRhoP),
<a name="l00038"></a>00038   _dataThetaP(dataThetaP),
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="comment">// The data errors:</span>
<a name="l00041"></a>00041   _dataRhoErrN(dataRhoErrN),
<a name="l00042"></a>00042   _dataRhoErrP(dataRhoErrP),
<a name="l00043"></a>00043   _dataThetaErrN(dataThetaErrN),
<a name="l00044"></a>00044   _dataThetaErrP(dataThetaErrP),
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="comment">// Variation of stat errs with true rho:</span>
<a name="l00047"></a>00047   _rhoErr(0.2345, -0.2818, 0.1899, -0.04834),
<a name="l00048"></a>00048   _thetaErr(80.59, -141.4, 117.8, -35.52),
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   <span class="comment">// Variation of stat err spreads with true rho:</span>
<a name="l00051"></a>00051   _rhoErrSpread(0.08218, -0.1961, 0.1706, -0.05117),
<a name="l00052"></a>00052   _thetaErrSpread(40.9, -98.06, 94.26, -31.66),
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="comment">// Variation of stat err pull sigmas with true rho:</span>
<a name="l00055"></a>00055   _rhoPullSigma(1.003, -0.256, 0.3339, -0.1355),
<a name="l00056"></a>00056   _thetaPullSigma(1.188, -0.06302, 0.08119, -0.04653),
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <span class="comment">// Variation of stat err pull biases with true rho:</span>
<a name="l00059"></a>00059   _biasPullRho(-0.02635, -0.0845, 0.05691, 0.009782),
<a name="l00060"></a>00060   _biasPullTheta(0.006253, -0.04283, 0.07425, -0.05055),
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   <span class="comment">// Syst err calculators:</span>
<a name="l00063"></a>00063   _errMatSyst(kFALSE),          <span class="comment">// without model</span>
<a name="l00064"></a>00064   _errMatModel(kFALSE, kTRUE),  <span class="comment">// model only</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   <span class="comment">// Other:</span>
<a name="l00067"></a>00067   _verbose(kFALSE)
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069   <span class="comment">// Stat err calculator:</span>
<a name="l00070"></a>00070   setupErrMatStatGauss();
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="comment">// Prepare chi^2 lookup table:</span>
<a name="l00073"></a>00073   makeTable();
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="classCLTreeMaker.html#9633f1dc10e81c6da6692e1c9220de1c">00078</a> <a class="code" href="classCLTreeMaker.html#9633f1dc10e81c6da6692e1c9220de1c">CLTreeMaker::~CLTreeMaker</a>() {}
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="classCLTreeMaker.html#9ae85ce9f91a53681931d92a614e3ee1">00082</a> <span class="keywordtype">void</span> <a class="code" href="classCLTreeMaker.html#9ae85ce9f91a53681931d92a614e3ee1">CLTreeMaker::setupErrMatStatGauss</a>(Bool_t plotPoly3) {
<a name="l00083"></a>00083   <span class="keywordflow">if</span> (plotPoly3){
<a name="l00084"></a>00084     <span class="comment">// check that we did the Poly3 objects:right:</span>
<a name="l00085"></a>00085     TCanvas * can = <span class="keyword">new</span> TCanvas(<span class="stringliteral">"poly3"</span>, <span class="stringliteral">"poly3 objects"</span>, 800, 800);
<a name="l00086"></a>00086     can-&gt;Divide(2,2);
<a name="l00087"></a>00087     
<a name="l00088"></a>00088     can-&gt;cd(1);
<a name="l00089"></a>00089     <a class="code" href="classCLTreeMaker.html#bbd5eedddd6db1df4670f25639e6cc66">_rhoErr</a>.<a class="code" href="classPoly3.html#3f2a06df4d615e33214b44d3c0c6a8c4">draw</a>();
<a name="l00090"></a>00090     
<a name="l00091"></a>00091     can-&gt;cd(2);
<a name="l00092"></a>00092     <a class="code" href="classCLTreeMaker.html#58ebd3a1fa9cb4c59c677e3ca4c1a4fc">_thetaErr</a>.<a class="code" href="classPoly3.html#3f2a06df4d615e33214b44d3c0c6a8c4">draw</a>();
<a name="l00093"></a>00093     
<a name="l00094"></a>00094     can-&gt;cd(3);
<a name="l00095"></a>00095     <a class="code" href="classCLTreeMaker.html#b56ebe4b90a1881b7f3240788bb0bc80">_rhoErrSpread</a>.<a class="code" href="classPoly3.html#3f2a06df4d615e33214b44d3c0c6a8c4">draw</a>();
<a name="l00096"></a>00096     
<a name="l00097"></a>00097     can-&gt;cd(4);
<a name="l00098"></a>00098     <a class="code" href="classCLTreeMaker.html#eae37f35382d88ab78cb481e92885e61">_thetaErrSpread</a>.<a class="code" href="classPoly3.html#3f2a06df4d615e33214b44d3c0c6a8c4">draw</a>();
<a name="l00099"></a>00099   }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="comment">// The number of spreads the errors are from the average in the data fit.</span>
<a name="l00102"></a>00102   <span class="comment">// The rho results of the data fit are taken as true rho for the purpose</span>
<a name="l00103"></a>00103   <span class="comment">// of calculating the spreads:</span>
<a name="l00104"></a>00104   <span class="keywordtype">double</span> rhoErrNSpreads[2] = {
<a name="l00105"></a>00105     (<a class="code" href="classCLTreeMaker.html#412840b0e0bc3e2d760a616b4106b171">_dataRhoErrN</a> - <a class="code" href="classCLTreeMaker.html#bbd5eedddd6db1df4670f25639e6cc66">_rhoErr</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#d3a19c74cfbbe892892fc829f1e6805c">_dataRhoN</a>)) / <a class="code" href="classCLTreeMaker.html#b56ebe4b90a1881b7f3240788bb0bc80">_rhoErrSpread</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#d3a19c74cfbbe892892fc829f1e6805c">_dataRhoN</a>),
<a name="l00106"></a>00106     (<a class="code" href="classCLTreeMaker.html#6ea5672692cd851fcacc51a79ea8aea2">_dataRhoErrP</a> - <a class="code" href="classCLTreeMaker.html#bbd5eedddd6db1df4670f25639e6cc66">_rhoErr</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#6fd2cf6475be85b4bc85150e4e706c56">_dataRhoP</a>)) / <a class="code" href="classCLTreeMaker.html#b56ebe4b90a1881b7f3240788bb0bc80">_rhoErrSpread</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#6fd2cf6475be85b4bc85150e4e706c56">_dataRhoP</a>)
<a name="l00107"></a>00107   };
<a name="l00108"></a>00108   
<a name="l00109"></a>00109   <span class="keywordtype">double</span> thetaErrNSpreads[2] = {
<a name="l00110"></a>00110     (<a class="code" href="classCLTreeMaker.html#32aac5ac66b5c1336c2140d4659f49a5">_dataThetaErrN</a> - <a class="code" href="classCLTreeMaker.html#58ebd3a1fa9cb4c59c677e3ca4c1a4fc">_thetaErr</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#d3a19c74cfbbe892892fc829f1e6805c">_dataRhoN</a>)) / <a class="code" href="classCLTreeMaker.html#eae37f35382d88ab78cb481e92885e61">_thetaErrSpread</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#d3a19c74cfbbe892892fc829f1e6805c">_dataRhoN</a>),
<a name="l00111"></a>00111     (<a class="code" href="classCLTreeMaker.html#3ac37669413f109c1905c7ccedb666a0">_dataThetaErrP</a> - <a class="code" href="classCLTreeMaker.html#58ebd3a1fa9cb4c59c677e3ca4c1a4fc">_thetaErr</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#6fd2cf6475be85b4bc85150e4e706c56">_dataRhoP</a>)) / <a class="code" href="classCLTreeMaker.html#eae37f35382d88ab78cb481e92885e61">_thetaErrSpread</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(<a class="code" href="classCLTreeMaker.html#6fd2cf6475be85b4bc85150e4e706c56">_dataRhoP</a>)
<a name="l00112"></a>00112   };
<a name="l00113"></a>00113 
<a name="l00114"></a>00114   <span class="comment">// Print out how the theta NSpreads are calculated:</span>
<a name="l00115"></a>00115   <span class="comment">//  cout &lt;&lt; dataThetaErrN &lt;&lt; " - " &lt;&lt; thetaErr.getVal(dataRhoN)</span>
<a name="l00116"></a>00116   <span class="comment">//       &lt;&lt; " / " &lt;&lt; thetaErrSpread.getVal(dataRhoN) </span>
<a name="l00117"></a>00117   <span class="comment">//       &lt;&lt; " = " &lt;&lt; thetaErrNSpreads[0] &lt;&lt; endl;</span>
<a name="l00118"></a>00118   <span class="comment">//  cout &lt;&lt; dataThetaErrP &lt;&lt; " - " &lt;&lt; thetaErr.getVal(dataRhoP)</span>
<a name="l00119"></a>00119   <span class="comment">//       &lt;&lt; " / " &lt;&lt; thetaErrSpread.getVal(dataRhoP) </span>
<a name="l00120"></a>00120   <span class="comment">//       &lt;&lt; " = " &lt;&lt; thetaErrNSpreads[1] &lt;&lt; endl;</span>
<a name="l00121"></a>00121   
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="keywordflow">if</span> (plotPoly3){  
<a name="l00124"></a>00124     cout &lt;&lt; <span class="stringliteral">"Spreads are "</span>  &lt;&lt; endl
<a name="l00125"></a>00125          &lt;&lt; <span class="stringliteral">"  rho-: "</span> &lt;&lt; rhoErrNSpreads[0] &lt;&lt; endl
<a name="l00126"></a>00126          &lt;&lt; <span class="stringliteral">"  theta-: "</span> &lt;&lt; thetaErrNSpreads[0] &lt;&lt; endl
<a name="l00127"></a>00127          &lt;&lt; <span class="stringliteral">"  rho+: "</span> &lt;&lt; rhoErrNSpreads[1] &lt;&lt; endl
<a name="l00128"></a>00128          &lt;&lt; <span class="stringliteral">"  theta+: "</span> &lt;&lt; thetaErrNSpreads[1] &lt;&lt; endl;
<a name="l00129"></a>00129   }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#01d149e4ac636b125ae9e49f8d792a78">init</a>(<a class="code" href="classCLTreeMaker.html#bbd5eedddd6db1df4670f25639e6cc66">_rhoErr</a>, <a class="code" href="classCLTreeMaker.html#58ebd3a1fa9cb4c59c677e3ca4c1a4fc">_thetaErr</a>, 
<a name="l00132"></a>00132                    <a class="code" href="classCLTreeMaker.html#b56ebe4b90a1881b7f3240788bb0bc80">_rhoErrSpread</a>, <a class="code" href="classCLTreeMaker.html#eae37f35382d88ab78cb481e92885e61">_thetaErrSpread</a>,
<a name="l00133"></a>00133                    <a class="code" href="classCLTreeMaker.html#c9c689be2eb6dbe6d2bdea3b53b69996">_rhoPullSigma</a>, <a class="code" href="classCLTreeMaker.html#6cca4f9d5739ad320cb903edfed17f60">_thetaPullSigma</a>,
<a name="l00134"></a>00134                    rhoErrNSpreads, thetaErrNSpreads);
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="comment">// Make a confidence-level and chi^2 tree from the raw MC experiments:</span>
<a name="l00142"></a><a class="code" href="classCLTreeMaker.html#818af3f2a0650392b633883c82affeff">00142</a> <span class="keywordtype">void</span> <a class="code" href="classCLTreeMaker.html#818af3f2a0650392b633883c82affeff">CLTreeMaker::makeCLTree</a>(<span class="keywordtype">int</span> nBinsR,
<a name="l00143"></a>00143                              <span class="keywordtype">int</span> nBinsGD,
<a name="l00144"></a>00144                              <span class="keyword">const</span> <span class="keywordtype">char</span> * writeFilename,
<a name="l00145"></a>00145                              <span class="keywordtype">double</span> rBMin,
<a name="l00146"></a>00146                              <span class="keywordtype">double</span> rBMax,
<a name="l00147"></a>00147                              <span class="keywordtype">double</span> gammaMin,
<a name="l00148"></a>00148                              <span class="keywordtype">double</span> gammaMax,
<a name="l00149"></a>00149                              <span class="keywordtype">double</span> deltaMin,
<a name="l00150"></a>00150                              <span class="keywordtype">double</span> deltaMax) {
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   TString fileName = writeFilename;
<a name="l00153"></a>00153   fileName += <span class="stringliteral">".root"</span>;
<a name="l00154"></a>00154   TFile * file = 0;
<a name="l00155"></a>00155   <span class="keywordflow">if</span> (0 != writeFilename) {
<a name="l00156"></a>00156     <span class="comment">// Open the file to write the _tree:</span>
<a name="l00157"></a>00157     file = <span class="keyword">new</span> TFile (fileName, <span class="stringliteral">"RECREATE"</span>);
<a name="l00158"></a>00158   }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <span class="comment">// Create the tree. The branch vars are float to save space, but </span>
<a name="l00161"></a>00161   <span class="comment">// the intermediate vars are double for high precision. So copy</span>
<a name="l00162"></a>00162   <span class="comment">// from double to float before filling ntuple:</span>
<a name="l00163"></a>00163   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a> = <span class="keyword">new</span> TTree(<span class="stringliteral">"makeCLTree"</span>, <span class="stringliteral">"makeCLTree"</span>);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="keywordtype">double</span> rB;
<a name="l00166"></a>00166   <span class="keywordtype">float</span> rBF;
<a name="l00167"></a>00167   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"rB"</span>, &amp;rBF, <span class="stringliteral">"rB/F"</span>);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="keywordtype">double</span> gammaVal;  <span class="comment">// needs to be != "gamma", which appears in math.h</span>
<a name="l00170"></a>00170   <span class="keywordtype">float</span> gammaValF;
<a name="l00171"></a>00171   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"gamma"</span>, &amp;gammaValF, <span class="stringliteral">"gamma/F"</span>);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keywordtype">double</span> delta;
<a name="l00174"></a>00174   <span class="keywordtype">float</span> deltaF;
<a name="l00175"></a>00175   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"delta"</span>, &amp;deltaF, <span class="stringliteral">"delta/F"</span>);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177   <span class="keywordtype">double</span> genRhoN;
<a name="l00178"></a>00178   <span class="keywordtype">float</span> genRhoNF;
<a name="l00179"></a>00179   <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#fb4c7d5e89264f2dc910b456e6d16d25">_bigTree</a>) <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"genRhoN"</span>, &amp;genRhoNF, <span class="stringliteral">"genRhoN/F"</span>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordtype">double</span> genThetaN;
<a name="l00182"></a>00182   <span class="keywordtype">float</span> genThetaNF;
<a name="l00183"></a>00183   <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#fb4c7d5e89264f2dc910b456e6d16d25">_bigTree</a>) <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"genThetaN"</span>, &amp;genThetaNF, <span class="stringliteral">"genThetaN/F"</span>);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   <span class="keywordtype">double</span> genRhoP;
<a name="l00186"></a>00186   <span class="keywordtype">float</span> genRhoPF;
<a name="l00187"></a>00187   <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#fb4c7d5e89264f2dc910b456e6d16d25">_bigTree</a>) <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"genRhoP"</span>, &amp;genRhoPF, <span class="stringliteral">"genRhoP/F"</span>);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <span class="keywordtype">double</span> genThetaP;
<a name="l00190"></a>00190   <span class="keywordtype">float</span> genThetaPF;
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#fb4c7d5e89264f2dc910b456e6d16d25">_bigTree</a>) <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"genThetaP"</span>, &amp;genThetaPF, <span class="stringliteral">"genThetaP/F"</span>);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keywordtype">double</span> chi2Stat[2];
<a name="l00194"></a>00194   <span class="keywordtype">float</span> chi2StatF[2];
<a name="l00195"></a>00195   <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#fb4c7d5e89264f2dc910b456e6d16d25">_bigTree</a>) {
<a name="l00196"></a>00196     <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"chi2Stat"</span>, &amp;chi2StatF[0], <span class="stringliteral">"chi2Stat/F"</span>);
<a name="l00197"></a>00197     <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"chi2StatBias"</span>, &amp;chi2StatF[1], <span class="stringliteral">"chi2StatBias/F"</span>);
<a name="l00198"></a>00198   }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200   <span class="keywordtype">double</span> clStat[2];
<a name="l00201"></a>00201   <span class="keywordtype">float</span> clStatF[2];
<a name="l00202"></a>00202   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"clStat"</span>, &amp;clStatF[0], <span class="stringliteral">"clStat/F"</span>);
<a name="l00203"></a>00203   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"clStatBias"</span>, &amp;clStatF[1], <span class="stringliteral">"clStatBias/F"</span>);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <span class="keywordtype">double</span> chi2StatSyst[2];
<a name="l00206"></a>00206   <span class="keywordtype">float</span> chi2StatSystF[2];
<a name="l00207"></a>00207   <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#fb4c7d5e89264f2dc910b456e6d16d25">_bigTree</a>) {
<a name="l00208"></a>00208     <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"chi2StatSyst"</span>, &amp;chi2StatSystF[0], <span class="stringliteral">"chi2StatSyst/F"</span>);
<a name="l00209"></a>00209     <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"chi2StatSystBias"</span>, &amp;chi2StatSystF[1], <span class="stringliteral">"chi2StatSystBias/F"</span>);
<a name="l00210"></a>00210   }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   <span class="keywordtype">double</span> clStatSyst[2];
<a name="l00213"></a>00213   <span class="keywordtype">float</span> clStatSystF[2];
<a name="l00214"></a>00214   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"clStatSyst"</span>, &amp;clStatSystF[0], <span class="stringliteral">"clStatSyst/F"</span>);
<a name="l00215"></a>00215   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"clStatSystBias"</span>, &amp;clStatSystF[1], <span class="stringliteral">"clStatSystBias/F"</span>);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="keywordtype">double</span> chi2All[2];
<a name="l00218"></a>00218   <span class="keywordtype">float</span> chi2AllF[2];
<a name="l00219"></a>00219   <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#fb4c7d5e89264f2dc910b456e6d16d25">_bigTree</a>) {  
<a name="l00220"></a>00220     <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"chi2All"</span>, &amp;chi2AllF[0], <span class="stringliteral">"chi2All/F"</span>);
<a name="l00221"></a>00221     <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"chi2AllBias"</span>, &amp;chi2AllF[1], <span class="stringliteral">"chi2AllBias/F"</span>);
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keywordtype">double</span> clAll[2];
<a name="l00225"></a>00225   <span class="keywordtype">float</span> clAllF[2];
<a name="l00226"></a>00226   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"clAll"</span>, &amp;clAllF[0], <span class="stringliteral">"clAll/F"</span>);
<a name="l00227"></a>00227   <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Branch(<span class="stringliteral">"clAllBias"</span>, &amp;clAllF[1], <span class="stringliteral">"clAllBias/F"</span>);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="comment">// the rB step is the same as the gamma and delta step, calculated</span>
<a name="l00230"></a>00230   <span class="comment">// with the same nBinsGD. This isbecause each job does a different </span>
<a name="l00231"></a>00231   <span class="comment">// section of the rB range, determined with rBMin:</span>
<a name="l00232"></a>00232   <span class="keyword">const</span> <span class="keywordtype">double</span> rBStep = (rBMax - rBMin) / nBinsGD;
<a name="l00233"></a>00233   <span class="keyword">const</span> <span class="keywordtype">double</span> gammaStep = (gammaMax - gammaMin) / nBinsGD;
<a name="l00234"></a>00234   <span class="keyword">const</span> <span class="keywordtype">double</span> deltaStep = (deltaMax - deltaMin) / nBinsGD;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236   <span class="comment">// loop over points:</span>
<a name="l00237"></a>00237   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = 0; iR &lt; nBinsR; ++iR){
<a name="l00238"></a>00238     rB = rBMin + (iR + 0.5) * rBStep;
<a name="l00239"></a>00239     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iG = 0; iG &lt; nBinsGD; ++iG){
<a name="l00240"></a>00240       gammaVal = gammaMin + (iG + 0.5) * gammaStep;
<a name="l00241"></a>00241       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iD = 0; iD &lt; nBinsGD; ++iD){
<a name="l00242"></a>00242         delta = deltaMin + (iD + 0.5) * deltaStep;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <span class="comment">// Calculate the experimental coordinates:</span>
<a name="l00245"></a>00245         <a class="code" href="classCLTreeMaker.html#7e90aa6a28db2d9b53d07747481ae500">coordTrans</a>(rB, gammaVal, delta, &amp;genRhoN, &amp;genThetaN, &amp;genRhoP, &amp;genThetaP);
<a name="l00246"></a>00246         
<a name="l00247"></a>00247         
<a name="l00248"></a>00248         
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#5c513ccd9d3de58b2ce6ec56ff77d311">_verbose</a>) {
<a name="l00250"></a>00250           cout &lt;&lt; <span class="stringliteral">"rB="</span> &lt;&lt; rB &lt;&lt; <span class="stringliteral">" gamma="</span> &lt;&lt; gammaVal &lt;&lt; <span class="stringliteral">" delta="</span> &lt;&lt; delta 
<a name="l00251"></a>00251                &lt;&lt; endl
<a name="l00252"></a>00252                &lt;&lt; <span class="stringliteral">"rM="</span> &lt;&lt; genRhoN &lt;&lt; <span class="stringliteral">" tM="</span> &lt;&lt; genThetaN 
<a name="l00253"></a>00253                &lt;&lt; <span class="stringliteral">" rP="</span> &lt;&lt; genRhoP &lt;&lt; <span class="stringliteral">" tP="</span> &lt;&lt; genThetaP &lt;&lt; endl;
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255         
<a name="l00256"></a>00256         <span class="comment">// The stat error matrix:</span>
<a name="l00257"></a>00257         TMatrixD errMatStat = 
<a name="l00258"></a>00258           <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#e8772898eb1c3c61e89a86b3362222bb">matrix</a>(genRhoN, genThetaN, genRhoP, genThetaP);
<a name="l00259"></a>00259         
<a name="l00260"></a>00260         <span class="comment">// The syst error matrix:</span>
<a name="l00261"></a>00261         TMatrixD errMatSyst = 
<a name="l00262"></a>00262           <a class="code" href="classCLTreeMaker.html#fec70c68c89f21c6fe464c27a2e8ecba">_errMatSyst</a>.<a class="code" href="classErrMatSyst.html#0fe28958e26f7068767c368c1875d16e">matrix</a>(genRhoN, genThetaN, genRhoP, genThetaP);
<a name="l00263"></a>00263         
<a name="l00264"></a>00264         <span class="comment">// The model error matrix:</span>
<a name="l00265"></a>00265         TMatrixD errMatModel = 
<a name="l00266"></a>00266           <a class="code" href="classCLTreeMaker.html#08df16c8450602c9f8f1699a4d355df8">_errMatModel</a>.<a class="code" href="classErrMatSyst.html#0fe28958e26f7068767c368c1875d16e">matrix</a>(genRhoN, genThetaN, genRhoP, genThetaP);
<a name="l00267"></a>00267         
<a name="l00268"></a>00268         <span class="comment">// From the true experimental coordinates, calculate the difference</span>
<a name="l00269"></a>00269         <span class="comment">// vectors to the point we found in the data fit:</span>
<a name="l00270"></a>00270         <span class="keyword">const</span> <span class="keywordtype">int</span> NEXPCOORD = 4;
<a name="l00271"></a>00271         
<a name="l00272"></a>00272         TMatrixD diff(NEXPCOORD, 1);
<a name="l00273"></a>00273         diff(0,0) = <a class="code" href="classCLTreeMaker.html#d3a19c74cfbbe892892fc829f1e6805c">_dataRhoN</a> - genRhoN; 
<a name="l00274"></a>00274         diff(1,0) = <a class="code" href="classCLTreeMaker.html#a4fd4067c35ddb2d6f1c4b3faf696f15">_dataThetaN</a> - genThetaN;
<a name="l00275"></a>00275         diff(2,0) = <a class="code" href="classCLTreeMaker.html#6fd2cf6475be85b4bc85150e4e706c56">_dataRhoP</a> - genRhoP;
<a name="l00276"></a>00276         diff(3,0) = <a class="code" href="classCLTreeMaker.html#1c1e07c916d7f16cc8f730ab24382993">_dataThetaP</a> - genThetaP;
<a name="l00277"></a>00277         
<a name="l00278"></a>00278         <span class="comment">// Add the bias, which is a product of the measured error for </span>
<a name="l00279"></a>00279         <span class="comment">// the appropriate variable times the pull bias on that variable,</span>
<a name="l00280"></a>00280         <span class="comment">// given the true value of rho:</span>
<a name="l00281"></a>00281         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = 0; b &lt; 2; ++b) {
<a name="l00282"></a>00282           diff(0,0) -= b 
<a name="l00283"></a>00283             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#6ce640f0c255fe321241cfe8d4db6c68">measuredErrRho</a>(genRhoN, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa4e5ed5311a9ccde1c7d53c3d96c1d56b">ErrMatStatGauss::MINUS</a>)
<a name="l00284"></a>00284             * <a class="code" href="classCLTreeMaker.html#1f38d7d6805a6fdbbd32786c0a62c49a">_biasPullRho</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoN);
<a name="l00285"></a>00285           
<a name="l00286"></a>00286           diff(1,0) -= b 
<a name="l00287"></a>00287             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#4e5aaf838aa1ce811fc8a2776c197bc2">measuredErrTheta</a>(genRhoN, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa4e5ed5311a9ccde1c7d53c3d96c1d56b">ErrMatStatGauss::MINUS</a>)
<a name="l00288"></a>00288             * <a class="code" href="classCLTreeMaker.html#366780aa057528e871cd7b7fb80af8d9">_biasPullTheta</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoN);
<a name="l00289"></a>00289           
<a name="l00290"></a>00290           diff(2,0) -= b 
<a name="l00291"></a>00291             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#6ce640f0c255fe321241cfe8d4db6c68">measuredErrRho</a>(genRhoP, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa83eac3e054c0d7a75581cbcc826d05f4">ErrMatStatGauss::PLUS</a>)
<a name="l00292"></a>00292             * <a class="code" href="classCLTreeMaker.html#1f38d7d6805a6fdbbd32786c0a62c49a">_biasPullRho</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoP);
<a name="l00293"></a>00293           
<a name="l00294"></a>00294           diff(3,0) -= b 
<a name="l00295"></a>00295             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#4e5aaf838aa1ce811fc8a2776c197bc2">measuredErrTheta</a>(genRhoP, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa83eac3e054c0d7a75581cbcc826d05f4">ErrMatStatGauss::PLUS</a>)
<a name="l00296"></a>00296             * <a class="code" href="classCLTreeMaker.html#366780aa057528e871cd7b7fb80af8d9">_biasPullTheta</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoP);
<a name="l00297"></a>00297           
<a name="l00298"></a>00298           <span class="comment">// Take the transpose of the diff:</span>
<a name="l00299"></a>00299           TMatrixD diffT(1, NEXPCOORD);
<a name="l00300"></a>00300           diffT.Transpose(diff);
<a name="l00301"></a>00301           
<a name="l00302"></a>00302           <span class="comment">// Calculate the statistical chi^2 and 4D confidence level:</span>
<a name="l00303"></a>00303           <span class="keyword">const</span> <span class="keywordtype">int</span> NDOF = 4;
<a name="l00304"></a>00304           <a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">calcChi2Cl</a>(diff, diffT, errMatStat, NDOF, chi2Stat[b], clStat[b]);
<a name="l00305"></a>00305           
<a name="l00306"></a>00306           <span class="comment">// The stat+syst chi2 and conf level:</span>
<a name="l00307"></a>00307           TMatrixD errMatStatSyst = errMatStat + errMatSyst;
<a name="l00308"></a>00308           <a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">calcChi2Cl</a>(diff, diffT, errMatStatSyst, NDOF, chi2StatSyst[b], clStatSyst[b]);
<a name="l00309"></a>00309           
<a name="l00310"></a>00310           <span class="comment">// The stat+syst+model chi2 and conf level:</span>
<a name="l00311"></a>00311           TMatrixD errMatAll = errMatStatSyst + errMatModel;
<a name="l00312"></a>00312           <a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">calcChi2Cl</a>(diff, diffT, errMatAll, NDOF, chi2All[b], clAll[b]);
<a name="l00313"></a>00313           
<a name="l00314"></a>00314           <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#5c513ccd9d3de58b2ce6ec56ff77d311">_verbose</a>) {
<a name="l00315"></a>00315             cout &lt;&lt; <span class="stringliteral">"Bias factor = "</span> &lt;&lt; b &lt;&lt; endl;
<a name="l00316"></a>00316             diff.Print();
<a name="l00317"></a>00317             diffT.Print();
<a name="l00318"></a>00318             errMatStat.Print();
<a name="l00319"></a>00319             errMatAll.Print();
<a name="l00320"></a>00320             
<a name="l00321"></a>00321             cout &lt;&lt; <span class="stringliteral">"chi2All="</span> &lt;&lt; chi2All[b] &lt;&lt; <span class="stringliteral">", clAll="</span> &lt;&lt; clAll[b];
<a name="l00322"></a>00322             cout &lt;&lt; <span class="stringliteral">", chi2Stat="</span> &lt;&lt; chi2Stat[b] &lt;&lt; <span class="stringliteral">", clStat="</span> &lt;&lt; clStat[b];
<a name="l00323"></a>00323             cout &lt;&lt; <span class="stringliteral">", chi2StatSyst="</span> &lt;&lt; chi2StatSyst[b] &lt;&lt; <span class="stringliteral">", clStatSyst="</span> 
<a name="l00324"></a>00324                  &lt;&lt; clStatSyst[b];
<a name="l00325"></a>00325             cout &lt;&lt; endl &lt;&lt; endl;
<a name="l00326"></a>00326           }
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328         
<a name="l00329"></a>00329         <span class="comment">// Fill the _tree and histograms:</span>
<a name="l00330"></a>00330         
<a name="l00331"></a>00331         rBF = rB;
<a name="l00332"></a>00332         gammaValF = gammaVal;   
<a name="l00333"></a>00333         deltaF = delta;
<a name="l00334"></a>00334         genRhoNF = genRhoN;
<a name="l00335"></a>00335         genThetaNF = genThetaN;
<a name="l00336"></a>00336         genRhoPF = genRhoP;
<a name="l00337"></a>00337         genThetaPF = genThetaP;
<a name="l00338"></a>00338         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {
<a name="l00339"></a>00339           chi2StatF[i] = chi2Stat[i];
<a name="l00340"></a>00340           clStatF[i] = clStat[i];
<a name="l00341"></a>00341           chi2StatSystF[i] = chi2StatSyst[i];
<a name="l00342"></a>00342           clStatSystF[i] = clStatSyst[i];
<a name="l00343"></a>00343           chi2AllF[i] = chi2All[i];
<a name="l00344"></a>00344           clAllF[i] = clAll[i];
<a name="l00345"></a>00345         }
<a name="l00346"></a>00346         
<a name="l00347"></a>00347         <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Fill();
<a name="l00348"></a>00348 
<a name="l00349"></a>00349       }
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351   } 
<a name="l00352"></a>00352 
<a name="l00353"></a>00353   <span class="keywordflow">if</span> (0 != writeFilename) {
<a name="l00354"></a>00354     <span class="comment">// Write the _tree:</span>
<a name="l00355"></a>00355     <a class="code" href="classCLTreeMaker.html#586696d20c9f079f40a72f0353dfd386">_tree</a>-&gt;Write();
<a name="l00356"></a>00356     file-&gt;Close();
<a name="l00357"></a>00357   }
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">// Make a confidence-level and chi^2 TH3F from the raw MC experiments:</span>
<a name="l00362"></a><a class="code" href="classCLTreeMaker.html#dc880d847c6297303855ee9fc9affe27">00362</a> <span class="keywordtype">void</span> <a class="code" href="classCLTreeMaker.html#dc880d847c6297303855ee9fc9affe27">CLTreeMaker::makeCLHist3</a>(<span class="keywordtype">int</span> nBinsR,
<a name="l00363"></a>00363                               <span class="keywordtype">int</span> nBinsGD,
<a name="l00364"></a>00364                               <span class="keyword">const</span> <span class="keywordtype">char</span> * writeFilename,
<a name="l00365"></a>00365                               <span class="keywordtype">double</span> rBMin,
<a name="l00366"></a>00366                               <span class="keywordtype">double</span> rBMax,
<a name="l00367"></a>00367                               <span class="keywordtype">double</span> rBFullRange,
<a name="l00368"></a>00368                               <span class="keywordtype">double</span> gammaMin,
<a name="l00369"></a>00369                               <span class="keywordtype">double</span> gammaMax,
<a name="l00370"></a>00370                               <span class="keywordtype">double</span> deltaMin,
<a name="l00371"></a>00371                               <span class="keywordtype">double</span> deltaMax) {
<a name="l00372"></a>00372   
<a name="l00373"></a>00373   TString fileName = writeFilename;
<a name="l00374"></a>00374   fileName += <span class="stringliteral">".root"</span>;
<a name="l00375"></a>00375   TFile * file = 0;
<a name="l00376"></a>00376   <span class="keywordflow">if</span> (0 != writeFilename) {
<a name="l00377"></a>00377     <span class="comment">// Open the file to write the _tree:</span>
<a name="l00378"></a>00378     file = <span class="keyword">new</span> TFile (fileName, <span class="stringliteral">"RECREATE"</span>);
<a name="l00379"></a>00379   }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   <span class="comment">// Create the TH3F's: </span>
<a name="l00382"></a>00382   <a class="code" href="classCLTreeMaker.html#f448a7f2d4902f0568fb28903aaf80a2">_hCLStat</a> = <span class="keyword">new</span> TH3F(<span class="stringliteral">"hCLStat"</span>, <span class="stringliteral">"hCLStat"</span>,
<a name="l00383"></a>00383                     nBinsR, rBMin, rBMax,
<a name="l00384"></a>00384                     nBinsGD, gammaMin, gammaMax,
<a name="l00385"></a>00385                     nBinsGD, deltaMin, deltaMax);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   <a class="code" href="classCLTreeMaker.html#edde3863d6ee0884885fd3c82d873dd4">_hCLStatSyst</a> = <span class="keyword">new</span> TH3F(<span class="stringliteral">"hCLStatSyst"</span>, <span class="stringliteral">"hCLStatSyst"</span>,
<a name="l00388"></a>00388                     nBinsR, rBMin, rBMax,
<a name="l00389"></a>00389                     nBinsGD, gammaMin, gammaMax,
<a name="l00390"></a>00390                     nBinsGD, deltaMin, deltaMax);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <a class="code" href="classCLTreeMaker.html#92cd01ef4fb0301e59f9f3fc50e2b920">_hCLAll</a> = <span class="keyword">new</span> TH3F(<span class="stringliteral">"hCLAll"</span>, <span class="stringliteral">"hCLAll"</span>,
<a name="l00393"></a>00393                     nBinsR, rBMin, rBMax,
<a name="l00394"></a>00394                     nBinsGD, gammaMin, gammaMax,
<a name="l00395"></a>00395                     nBinsGD, deltaMin, deltaMax);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <a class="code" href="classCLTreeMaker.html#8d303f83da537412807d9a9e2dc50a12">_hChi2All</a> = <span class="keyword">new</span> TH3F(<span class="stringliteral">"hChi2All"</span>, <span class="stringliteral">"hChi2All"</span>,
<a name="l00398"></a>00398                     nBinsR, rBMin, rBMax,
<a name="l00399"></a>00399                     nBinsGD, gammaMin, gammaMax,
<a name="l00400"></a>00400                     nBinsGD, deltaMin, deltaMax);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402   <a class="code" href="classCLTreeMaker.html#90517857892319d6de43c0fb6e12993e">_hCLAllBias</a> = <span class="keyword">new</span> TH3F(<span class="stringliteral">"hCLAllBias"</span>, <span class="stringliteral">"hCLAllBias"</span>,
<a name="l00403"></a>00403                     nBinsR, rBMin, rBMax,
<a name="l00404"></a>00404                     nBinsGD, gammaMin, gammaMax,
<a name="l00405"></a>00405                     nBinsGD, deltaMin, deltaMax);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="comment">// the rB step is the same as the gamma and delta step, calculated</span>
<a name="l00409"></a>00409   <span class="comment">// with the same nBinsGD. This is because each job does a different </span>
<a name="l00410"></a>00410   <span class="comment">// section of the rB range, determined with rBMin:</span>
<a name="l00411"></a>00411   <span class="keyword">const</span> <span class="keywordtype">double</span> rBStep = rBFullRange / nBinsGD;
<a name="l00412"></a>00412   <span class="keyword">const</span> <span class="keywordtype">double</span> gammaStep = (gammaMax - gammaMin) / nBinsGD;
<a name="l00413"></a>00413   <span class="keyword">const</span> <span class="keywordtype">double</span> deltaStep = (deltaMax - deltaMin) / nBinsGD;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   <span class="comment">// loop over points:</span>
<a name="l00416"></a>00416   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iR = 1; iR &lt;= nBinsR; ++iR){
<a name="l00417"></a>00417     <span class="keywordtype">double</span> rB = rBMin + (iR - 0.5) * rBStep;
<a name="l00418"></a>00418     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iG = 1; iG &lt;= nBinsGD; ++iG){
<a name="l00419"></a>00419       <span class="keywordtype">double</span> gammaVal = gammaMin + (iG - 0.5) * gammaStep;
<a name="l00420"></a>00420       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iD = 1; iD &lt;= nBinsGD; ++iD){
<a name="l00421"></a>00421         <span class="keywordtype">double</span> delta = deltaMin + (iD - 0.5) * deltaStep;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423         <span class="comment">// Calculate the experimental coordinates:</span>
<a name="l00424"></a>00424         <span class="keywordtype">double</span> genRhoN;
<a name="l00425"></a>00425         <span class="keywordtype">double</span> genThetaN;
<a name="l00426"></a>00426         <span class="keywordtype">double</span> genRhoP;
<a name="l00427"></a>00427         <span class="keywordtype">double</span> genThetaP;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <a class="code" href="classCLTreeMaker.html#7e90aa6a28db2d9b53d07747481ae500">coordTrans</a>(rB, gammaVal, delta, 
<a name="l00430"></a>00430                    &amp;genRhoN, &amp;genThetaN, &amp;genRhoP, &amp;genThetaP);
<a name="l00431"></a>00431         
<a name="l00432"></a>00432         <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#5c513ccd9d3de58b2ce6ec56ff77d311">_verbose</a>) {
<a name="l00433"></a>00433           cout &lt;&lt; <span class="stringliteral">"rB="</span> &lt;&lt; rB &lt;&lt; <span class="stringliteral">" gamma="</span> &lt;&lt; gammaVal &lt;&lt; <span class="stringliteral">" delta="</span> &lt;&lt; delta 
<a name="l00434"></a>00434                &lt;&lt; endl
<a name="l00435"></a>00435                &lt;&lt; <span class="stringliteral">"rM="</span> &lt;&lt; genRhoN &lt;&lt; <span class="stringliteral">" tM="</span> &lt;&lt; genThetaN 
<a name="l00436"></a>00436                &lt;&lt; <span class="stringliteral">" rP="</span> &lt;&lt; genRhoP &lt;&lt; <span class="stringliteral">" tP="</span> &lt;&lt; genThetaP &lt;&lt; endl;
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438         
<a name="l00439"></a>00439         <span class="comment">// The stat error matrix:</span>
<a name="l00440"></a>00440         TMatrixD errMatStat = 
<a name="l00441"></a>00441           <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#e8772898eb1c3c61e89a86b3362222bb">matrix</a>(genRhoN, genThetaN, genRhoP, genThetaP);
<a name="l00442"></a>00442         
<a name="l00443"></a>00443         <span class="comment">// The syst error matrix:</span>
<a name="l00444"></a>00444         TMatrixD errMatSyst = 
<a name="l00445"></a>00445           <a class="code" href="classCLTreeMaker.html#fec70c68c89f21c6fe464c27a2e8ecba">_errMatSyst</a>.<a class="code" href="classErrMatSyst.html#0fe28958e26f7068767c368c1875d16e">matrix</a>(genRhoN, genThetaN, genRhoP, genThetaP);
<a name="l00446"></a>00446         
<a name="l00447"></a>00447         <span class="comment">// The model error matrix:</span>
<a name="l00448"></a>00448         TMatrixD errMatModel = 
<a name="l00449"></a>00449           <a class="code" href="classCLTreeMaker.html#08df16c8450602c9f8f1699a4d355df8">_errMatModel</a>.<a class="code" href="classErrMatSyst.html#0fe28958e26f7068767c368c1875d16e">matrix</a>(genRhoN, genThetaN, genRhoP, genThetaP);
<a name="l00450"></a>00450         
<a name="l00451"></a>00451         <span class="comment">// From the true experimental coordinates, calculate the difference</span>
<a name="l00452"></a>00452         <span class="comment">// vectors to the point we found in the data fit:</span>
<a name="l00453"></a>00453         <span class="keyword">const</span> <span class="keywordtype">int</span> NEXPCOORD = 4;
<a name="l00454"></a>00454         
<a name="l00455"></a>00455         TMatrixD diff(NEXPCOORD, 1);
<a name="l00456"></a>00456         diff(0,0) = <a class="code" href="classCLTreeMaker.html#d3a19c74cfbbe892892fc829f1e6805c">_dataRhoN</a> - genRhoN; 
<a name="l00457"></a>00457         diff(1,0) = <a class="code" href="classCLTreeMaker.html#a4fd4067c35ddb2d6f1c4b3faf696f15">_dataThetaN</a> - genThetaN;
<a name="l00458"></a>00458         diff(2,0) = <a class="code" href="classCLTreeMaker.html#6fd2cf6475be85b4bc85150e4e706c56">_dataRhoP</a> - genRhoP;
<a name="l00459"></a>00459         diff(3,0) = <a class="code" href="classCLTreeMaker.html#1c1e07c916d7f16cc8f730ab24382993">_dataThetaP</a> - genThetaP;
<a name="l00460"></a>00460         
<a name="l00461"></a>00461         <span class="keywordtype">double</span> chi2Stat[2];
<a name="l00462"></a>00462         <span class="keywordtype">double</span> clStat[2];
<a name="l00463"></a>00463         <span class="keywordtype">double</span> chi2StatSyst[2];
<a name="l00464"></a>00464         <span class="keywordtype">double</span> clStatSyst[2];
<a name="l00465"></a>00465         <span class="keywordtype">double</span> chi2All[2];
<a name="l00466"></a>00466         <span class="keywordtype">double</span> clAll[2];
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <span class="comment">// Add the bias, which is a product of the measured error for </span>
<a name="l00469"></a>00469         <span class="comment">// the appropriate variable times the pull bias on that variable,</span>
<a name="l00470"></a>00470         <span class="comment">// given the true value of rho:</span>
<a name="l00471"></a>00471         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = 0; b &lt; 2; ++b) {
<a name="l00472"></a>00472           diff(0,0) -= b 
<a name="l00473"></a>00473             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#6ce640f0c255fe321241cfe8d4db6c68">measuredErrRho</a>(genRhoN, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa4e5ed5311a9ccde1c7d53c3d96c1d56b">ErrMatStatGauss::MINUS</a>)
<a name="l00474"></a>00474             * <a class="code" href="classCLTreeMaker.html#1f38d7d6805a6fdbbd32786c0a62c49a">_biasPullRho</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoN);
<a name="l00475"></a>00475           
<a name="l00476"></a>00476           diff(1,0) -= b 
<a name="l00477"></a>00477             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#4e5aaf838aa1ce811fc8a2776c197bc2">measuredErrTheta</a>(genRhoN, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa4e5ed5311a9ccde1c7d53c3d96c1d56b">ErrMatStatGauss::MINUS</a>)
<a name="l00478"></a>00478             * <a class="code" href="classCLTreeMaker.html#366780aa057528e871cd7b7fb80af8d9">_biasPullTheta</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoN);
<a name="l00479"></a>00479           
<a name="l00480"></a>00480           diff(2,0) -= b 
<a name="l00481"></a>00481             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#6ce640f0c255fe321241cfe8d4db6c68">measuredErrRho</a>(genRhoP, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa83eac3e054c0d7a75581cbcc826d05f4">ErrMatStatGauss::PLUS</a>)
<a name="l00482"></a>00482             * <a class="code" href="classCLTreeMaker.html#1f38d7d6805a6fdbbd32786c0a62c49a">_biasPullRho</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoP);
<a name="l00483"></a>00483           
<a name="l00484"></a>00484           diff(3,0) -= b 
<a name="l00485"></a>00485             * <a class="code" href="classCLTreeMaker.html#ace02b3d07bd5d7caadb18b3b71aa93a">_errMatStat</a>.<a class="code" href="classErrMatStatGauss.html#4e5aaf838aa1ce811fc8a2776c197bc2">measuredErrTheta</a>(genRhoP, <a class="code" href="classErrMatStatGauss.html#e69d316f1dd69bf6c4806b22684143fa83eac3e054c0d7a75581cbcc826d05f4">ErrMatStatGauss::PLUS</a>)
<a name="l00486"></a>00486             * <a class="code" href="classCLTreeMaker.html#366780aa057528e871cd7b7fb80af8d9">_biasPullTheta</a>.<a class="code" href="classPoly3.html#e3f55eefb49ebcfb439adbe87f0067ab">getVal</a>(genRhoP);
<a name="l00487"></a>00487           
<a name="l00488"></a>00488           <span class="comment">// Take the transpose of the diff:</span>
<a name="l00489"></a>00489           TMatrixD diffT(1, NEXPCOORD);
<a name="l00490"></a>00490           diffT.Transpose(diff);
<a name="l00491"></a>00491           
<a name="l00492"></a>00492           <span class="comment">// Calculate the statistical chi^2 and 4D confidence level:</span>
<a name="l00493"></a>00493           <span class="keyword">const</span> <span class="keywordtype">int</span> NDOF = 4;
<a name="l00494"></a>00494           <a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">calcChi2Cl</a>(diff, diffT, errMatStat, NDOF, chi2Stat[b], clStat[b]);
<a name="l00495"></a>00495           
<a name="l00496"></a>00496           <span class="comment">//if (1==iG &amp;&amp; 1==iD &amp;&amp; 0==b) {</span>
<a name="l00497"></a>00497           <span class="comment">//  cout &lt;&lt; "------------------------" &lt;&lt; endl;</span>
<a name="l00498"></a>00498           <span class="comment">//  cout &lt;&lt; "iR="&lt;&lt; iR &lt;&lt; " rB=" &lt;&lt; rB &lt;&lt; endl;</span>
<a name="l00499"></a>00499           <span class="comment">//  cout &lt;&lt; "iG="&lt;&lt; iG &lt;&lt; " gamma=" &lt;&lt; gammaVal &lt;&lt; endl;</span>
<a name="l00500"></a>00500           <span class="comment">//  cout &lt;&lt; "iD="&lt;&lt; iD &lt;&lt; " delta=" &lt;&lt; delta &lt;&lt; endl;</span>
<a name="l00501"></a>00501           <span class="comment">//  cout &lt;&lt; "diff= ";</span>
<a name="l00502"></a>00502           <span class="comment">//  diff.Print();</span>
<a name="l00503"></a>00503           <span class="comment">//  cout &lt;&lt; "clStat=" &lt;&lt; clStat[0] &lt;&lt; endl;</span>
<a name="l00504"></a>00504           <span class="comment">//}</span>
<a name="l00505"></a>00505 
<a name="l00506"></a>00506           <span class="comment">// The stat+syst chi2 and conf level:</span>
<a name="l00507"></a>00507           TMatrixD errMatStatSyst = errMatStat + errMatSyst;
<a name="l00508"></a>00508           <a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">calcChi2Cl</a>(diff, diffT, errMatStatSyst, NDOF, chi2StatSyst[b], clStatSyst[b]);
<a name="l00509"></a>00509           
<a name="l00510"></a>00510           <span class="comment">// The stat+syst+model chi2 and conf level:</span>
<a name="l00511"></a>00511           TMatrixD errMatAll = errMatStatSyst + errMatModel;
<a name="l00512"></a>00512           <a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">calcChi2Cl</a>(diff, diffT, errMatAll, NDOF, chi2All[b], clAll[b]);
<a name="l00513"></a>00513           
<a name="l00514"></a>00514           <span class="keywordflow">if</span> (<a class="code" href="classCLTreeMaker.html#5c513ccd9d3de58b2ce6ec56ff77d311">_verbose</a>) {
<a name="l00515"></a>00515             cout &lt;&lt; <span class="stringliteral">"Bias factor = "</span> &lt;&lt; b &lt;&lt; endl;
<a name="l00516"></a>00516             diff.Print();
<a name="l00517"></a>00517             diffT.Print();
<a name="l00518"></a>00518             errMatStat.Print();
<a name="l00519"></a>00519             errMatAll.Print();
<a name="l00520"></a>00520             
<a name="l00521"></a>00521             cout &lt;&lt; <span class="stringliteral">"chi2All="</span> &lt;&lt; chi2All[b] &lt;&lt; <span class="stringliteral">", clAll="</span> &lt;&lt; clAll[b];
<a name="l00522"></a>00522             cout &lt;&lt; <span class="stringliteral">", chi2Stat="</span> &lt;&lt; chi2Stat[b] &lt;&lt; <span class="stringliteral">", clStat="</span> &lt;&lt; clStat[b];
<a name="l00523"></a>00523             cout &lt;&lt; <span class="stringliteral">", chi2StatSyst="</span> &lt;&lt; chi2StatSyst[b] &lt;&lt; <span class="stringliteral">", clStatSyst="</span> 
<a name="l00524"></a>00524                  &lt;&lt; clStatSyst[b];
<a name="l00525"></a>00525             cout &lt;&lt; endl &lt;&lt; endl;
<a name="l00526"></a>00526           }
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528         
<a name="l00529"></a>00529         <span class="comment">// Fill the histograms:</span>
<a name="l00530"></a>00530         <a class="code" href="classCLTreeMaker.html#f448a7f2d4902f0568fb28903aaf80a2">_hCLStat</a>-&gt;SetBinContent(iR, iG, iD, clStat[0]);
<a name="l00531"></a>00531         <a class="code" href="classCLTreeMaker.html#edde3863d6ee0884885fd3c82d873dd4">_hCLStatSyst</a>-&gt;SetBinContent(iR, iG, iD, clStatSyst[0]);
<a name="l00532"></a>00532         <a class="code" href="classCLTreeMaker.html#92cd01ef4fb0301e59f9f3fc50e2b920">_hCLAll</a>-&gt;SetBinContent(iR, iG, iD, clAll[0]);
<a name="l00533"></a>00533         <a class="code" href="classCLTreeMaker.html#8d303f83da537412807d9a9e2dc50a12">_hChi2All</a>-&gt;SetBinContent(iR, iG, iD, chi2All[0]);
<a name="l00534"></a>00534         <a class="code" href="classCLTreeMaker.html#90517857892319d6de43c0fb6e12993e">_hCLAllBias</a>-&gt;SetBinContent(iR, iG, iD, clAll[1]);
<a name="l00535"></a>00535       }
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537   } 
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="keywordflow">if</span> (0 != writeFilename) {
<a name="l00540"></a>00540     <span class="comment">// Write the _tree:</span>
<a name="l00541"></a>00541     <a class="code" href="classCLTreeMaker.html#f448a7f2d4902f0568fb28903aaf80a2">_hCLStat</a>-&gt;Write();
<a name="l00542"></a>00542     <a class="code" href="classCLTreeMaker.html#edde3863d6ee0884885fd3c82d873dd4">_hCLStatSyst</a>-&gt;Write();
<a name="l00543"></a>00543     <a class="code" href="classCLTreeMaker.html#92cd01ef4fb0301e59f9f3fc50e2b920">_hCLAll</a>-&gt;Write();
<a name="l00544"></a>00544     <a class="code" href="classCLTreeMaker.html#8d303f83da537412807d9a9e2dc50a12">_hChi2All</a>-&gt;Write();
<a name="l00545"></a>00545     <a class="code" href="classCLTreeMaker.html#90517857892319d6de43c0fb6e12993e">_hCLAllBias</a>-&gt;Write();
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     file-&gt;Close();
<a name="l00548"></a>00548   }
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 <span class="keywordtype">void</span> 
<a name="l00553"></a><a class="code" href="classCLTreeMaker.html#7e90aa6a28db2d9b53d07747481ae500">00553</a> <a class="code" href="classCLTreeMaker.html#7e90aa6a28db2d9b53d07747481ae500">CLTreeMaker::coordTrans</a>(<span class="keywordtype">double</span> rB, <span class="keywordtype">double</span> gamma, <span class="keywordtype">double</span> delta, 
<a name="l00554"></a>00554                         <span class="keywordtype">double</span> * rM, <span class="keywordtype">double</span> * tM, <span class="keywordtype">double</span> * rP, <span class="keywordtype">double</span> * tP,
<a name="l00555"></a>00555                         <span class="keywordtype">double</span> * xM, <span class="keywordtype">double</span> * yM, <span class="keywordtype">double</span> * xP, <span class="keywordtype">double</span> * yP) 
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557   <span class="keywordtype">double</span> g = gamma * <a class="code" href="classCLTreeMaker.html#223d97b1b9529a0f82ecda949a73b22f">pi</a>() / 180;
<a name="l00558"></a>00558   <span class="keywordtype">double</span> d = delta * <a class="code" href="classCLTreeMaker.html#223d97b1b9529a0f82ecda949a73b22f">pi</a>() / 180;
<a name="l00559"></a>00559   
<a name="l00560"></a>00560   <span class="keywordtype">double</span> xMinus = rB * cos (d - g);
<a name="l00561"></a>00561   <span class="keywordtype">double</span> yMinus = rB * sin (d - g);
<a name="l00562"></a>00562   <span class="keywordtype">double</span> xPlus  = rB * cos (d + g);
<a name="l00563"></a>00563   <span class="keywordtype">double</span> yPlus =  rB * sin (d + g);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   <span class="keywordflow">if</span> (0 != xM) {*xM = xMinus;}
<a name="l00566"></a>00566   <span class="keywordflow">if</span> (0 != yM) {*yM = yMinus;}
<a name="l00567"></a>00567   <span class="keywordflow">if</span> (0 != xP) {*xP = xPlus;}
<a name="l00568"></a>00568   <span class="keywordflow">if</span> (0 != yP) {*yP = yPlus;}
<a name="l00569"></a>00569   
<a name="l00570"></a>00570   <span class="keyword">const</span> <span class="keywordtype">double</span> x0 = 0.850;
<a name="l00571"></a>00571   <span class="keywordtype">double</span> rMinus = sqrt((xMinus - x0) * (xMinus - x0) + yMinus * yMinus);
<a name="l00572"></a>00572   <span class="keywordtype">double</span> rPlus  = sqrt((xPlus - x0)  * (xPlus - x0)  + yPlus  * yPlus);
<a name="l00573"></a>00573   <span class="keywordtype">double</span> tMinus = atan2(yMinus, (xMinus - x0)) * 180./<a class="code" href="classCLTreeMaker.html#223d97b1b9529a0f82ecda949a73b22f">pi</a>();
<a name="l00574"></a>00574   <span class="keywordtype">double</span> tPlus  = atan2(yPlus,  (xPlus - x0))  * 180./<a class="code" href="classCLTreeMaker.html#223d97b1b9529a0f82ecda949a73b22f">pi</a>();
<a name="l00575"></a>00575 
<a name="l00576"></a>00576   <span class="keywordflow">if</span> (tPlus &lt; 0)  tPlus  += 360;
<a name="l00577"></a>00577   <span class="keywordflow">if</span> (tMinus &lt; 0) tMinus += 360;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <span class="keywordflow">if</span> (0 != rM) {*rM = rMinus;}
<a name="l00580"></a>00580   <span class="keywordflow">if</span> (0 != tM) {*tM = tMinus;}
<a name="l00581"></a>00581   <span class="keywordflow">if</span> (0 != rP) {*rP = rPlus;}
<a name="l00582"></a>00582   <span class="keywordflow">if</span> (0 != tP) {*tP = tPlus;}
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">// calculates Gamma(ndof/2), needed to normalize the chi2 distribution.</span>
<a name="l00589"></a>00589 <span class="comment">// To get Gamma(x), call gammaHalf(x*2):</span>
<a name="l00590"></a><a class="code" href="classCLTreeMaker.html#76e89e13c38f6ec9aa2937e7f1a98c64">00590</a> <span class="keywordtype">double</span> <a class="code" href="classCLTreeMaker.html#76e89e13c38f6ec9aa2937e7f1a98c64">CLTreeMaker::gammaHalf</a>(<span class="keywordtype">int</span> ndof) {
<a name="l00591"></a>00591   <span class="keywordtype">double</span> result = 1;  
<a name="l00592"></a>00592   <span class="keywordtype">int</span> nhalf = ndof / 2;
<a name="l00593"></a>00593   <span class="keywordflow">if</span> (nhalf * 2 == ndof) {
<a name="l00594"></a>00594     <span class="comment">// ndof is even, so make use of the fact that the Gamma function for</span>
<a name="l00595"></a>00595     <span class="comment">// an integer n is (n-1)!.</span>
<a name="l00596"></a>00596     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 2; n &lt;= nhalf - 1; ++n) {
<a name="l00597"></a>00597       result *= (<span class="keywordtype">double</span>)n;
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599   }
<a name="l00600"></a>00600   <span class="keywordflow">else</span> {
<a name="l00601"></a>00601     <span class="comment">// Otherwise, use the facts that Gamma(x+1) = x * Gamma(x) and</span>
<a name="l00602"></a>00602     <span class="comment">// Gamma(1/2) = sqrt(pi):</span>
<a name="l00603"></a>00603     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> SQRTPI = sqrt(<a class="code" href="classCLTreeMaker.html#223d97b1b9529a0f82ecda949a73b22f">pi</a>());
<a name="l00604"></a>00604     result = SQRTPI;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     <span class="keywordflow">for</span> (<span class="keywordtype">double</span> x = 0.5; x &lt; ((double)ndof)/2; ++x) {
<a name="l00607"></a>00607       result *= x;
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609   }
<a name="l00610"></a>00610   <span class="keywordflow">return</span> result;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="comment">// The chi^2 distribution value for chi2 and ndof:</span>
<a name="l00615"></a><a class="code" href="classCLTreeMaker.html#772721049246225bd1b2cb6aed415953">00615</a> <span class="keywordtype">double</span> <a class="code" href="classCLTreeMaker.html#772721049246225bd1b2cb6aed415953">CLTreeMaker::chi2dist</a>(<span class="keywordtype">double</span> chi2, <span class="keywordtype">int</span> ndof) {
<a name="l00616"></a>00616   <span class="keywordtype">double</span> ndofHalf = ((double)ndof)/2;
<a name="l00617"></a>00617   <span class="keywordtype">double</span> denom = pow((<span class="keywordtype">double</span>)2.0, ndofHalf) * <a class="code" href="classCLTreeMaker.html#76e89e13c38f6ec9aa2937e7f1a98c64">gammaHalf</a>(ndof);
<a name="l00618"></a>00618   <span class="keywordtype">double</span> num = pow(chi2, ndofHalf - 1) * exp(-chi2/2);
<a name="l00619"></a>00619   <span class="keywordflow">return</span> num / denom;
<a name="l00620"></a>00620 }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="comment">// The integral of the chi2dist for ndof DOF, from chi2 to</span>
<a name="l00624"></a>00624 <span class="comment">// chi2 + ndof * maxNdof (taken to estimate infinity), calculated in</span>
<a name="l00625"></a>00625 <span class="comment">// steps of size ndof * stepNfod:</span>
<a name="l00626"></a><a class="code" href="classCLTreeMaker.html#c9029ba8b9f618e10308613b68540750">00626</a> <span class="keywordtype">double</span> <a class="code" href="classCLTreeMaker.html#c9029ba8b9f618e10308613b68540750">CLTreeMaker::pValue</a>(<span class="keywordtype">double</span> chi2,
<a name="l00627"></a>00627                            <span class="keywordtype">int</span> ndof,
<a name="l00628"></a>00628                            <span class="keywordtype">double</span> stepNdof,
<a name="l00629"></a>00629                            <span class="keywordtype">double</span> maxNdof) {
<a name="l00630"></a>00630   <span class="keywordtype">double</span> result = 0;
<a name="l00631"></a>00631   <span class="keywordflow">for</span> (<span class="keywordtype">double</span> x = chi2; x &lt; chi2 + maxNdof * ndof; x += stepNdof * ndof) {
<a name="l00632"></a>00632     result += <a class="code" href="classCLTreeMaker.html#772721049246225bd1b2cb6aed415953">chi2dist</a>(x, ndof);
<a name="l00633"></a>00633   }
<a name="l00634"></a>00634   <span class="keywordflow">return</span> result * stepNdof * ndof;
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="comment">// cl() returns 1-pValue(), recalculated for better accuracy:</span>
<a name="l00639"></a><a class="code" href="classCLTreeMaker.html#229d43937c4d8b740d77c65caa9455c9">00639</a> <span class="keywordtype">double</span> <a class="code" href="classCLTreeMaker.html#229d43937c4d8b740d77c65caa9455c9">CLTreeMaker::cl</a>(<span class="keywordtype">double</span> chi2,
<a name="l00640"></a>00640                        <span class="keywordtype">int</span> ndof,
<a name="l00641"></a>00641                        <span class="keywordtype">double</span> stepNdof,
<a name="l00642"></a>00642                        <span class="keywordtype">double</span> maxNdof) {
<a name="l00643"></a>00643   <span class="comment">// For 1 DOF, avoid the divergence at x=0:</span>
<a name="l00644"></a>00644   <span class="keywordflow">switch</span>(ndof) {
<a name="l00645"></a>00645   <span class="keywordflow">case</span> 1: 
<a name="l00646"></a>00646     <span class="keywordflow">return</span> 1.0 - <a class="code" href="classCLTreeMaker.html#c9029ba8b9f618e10308613b68540750">pValue</a>(chi2, ndof, stepNdof, maxNdof);
<a name="l00647"></a>00647     <span class="keywordflow">break</span>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649   <span class="keywordflow">default</span>:    
<a name="l00650"></a>00650     <span class="keywordtype">double</span> result = 0;
<a name="l00651"></a>00651     <span class="keywordflow">for</span> (<span class="keywordtype">double</span> x = 0; x &lt; chi2; x += stepNdof * ndof) {
<a name="l00652"></a>00652       result += <a class="code" href="classCLTreeMaker.html#772721049246225bd1b2cb6aed415953">chi2dist</a>(x, ndof);
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654     <span class="keywordflow">return</span> result * stepNdof * ndof;
<a name="l00655"></a>00655   }
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 
<a name="l00659"></a>00659 <span class="comment">// Calculate the chi^2 and CL given 2 vectors and an error matrix: </span>
<a name="l00660"></a><a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">00660</a> <span class="keywordtype">void</span> <a class="code" href="classCLTreeMaker.html#548b00de230807cd19057738b40ea741">CLTreeMaker::calcChi2Cl</a>(<span class="keyword">const</span> TMatrixD &amp; diff, 
<a name="l00661"></a>00661                              <span class="keyword">const</span> TMatrixD &amp; diffT, 
<a name="l00662"></a>00662                              <span class="keyword">const</span> TMatrixD &amp; errMat,
<a name="l00663"></a>00663                              <span class="keywordtype">int</span> nDOF,
<a name="l00664"></a>00664                              <span class="keywordtype">double</span> &amp; chi2, 
<a name="l00665"></a>00665                              <span class="keywordtype">double</span> &amp; clevel)<span class="keyword"> const </span>{
<a name="l00666"></a>00666   TMatrixD invErrMat = errMat;
<a name="l00667"></a>00667   invErrMat.Invert();
<a name="l00668"></a>00668   TMatrixD chi2Mat = diffT * invErrMat * diff;
<a name="l00669"></a>00669   chi2 = chi2Mat(0,0);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   <span class="keywordflow">if</span> (4 == nDOF) { <span class="comment">// then we have a lookup table:</span>
<a name="l00672"></a>00672     clevel = <a class="code" href="classCLTreeMaker.html#100c24d9686e1743d4c5cbb476257505">lookupCL_4</a>(chi2);
<a name="l00673"></a>00673   }
<a name="l00674"></a>00674   <span class="keywordflow">else</span> {
<a name="l00675"></a>00675     <span class="comment">// For efficiency, only calculate if the chi^2/nDOF is different from</span>
<a name="l00676"></a>00676     <span class="comment">// unity by less than _maxNDof widths of the chi^2 distribution, </span>
<a name="l00677"></a>00677     <span class="comment">// a width being sqrt(2*nDOF). Otherwise, return 1.1:    </span>
<a name="l00678"></a>00678     <span class="keywordflow">if</span> ((chi2/nDOF - 1) / sqrt(2.0 * nDOF) &lt; <a class="code" href="classCLTreeMaker.html#4e6f6f6bae2bac20b0ca16e3ce4aa104">_maxNDof</a>) {
<a name="l00679"></a>00679       clevel = <a class="code" href="classCLTreeMaker.html#229d43937c4d8b740d77c65caa9455c9">cl</a>(chi2, nDOF); 
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681     <span class="keywordflow">else</span> {
<a name="l00682"></a>00682       clevel = 1.1;
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 
<a name="l00688"></a><a class="code" href="classCLTreeMaker.html#4230b69f9b43abac227bddce77e9e425">00688</a> <span class="keywordtype">void</span> <a class="code" href="classCLTreeMaker.html#4230b69f9b43abac227bddce77e9e425">CLTreeMaker::makeTable</a>() {
<a name="l00689"></a>00689   <span class="comment">// Make the chi^2 lookup table:</span>
<a name="l00690"></a>00690   <a class="code" href="classCLTreeMaker.html#7f06740d4a5b7d1dd23786e74c4433d9">_chi2Int_4</a> = <span class="keyword">new</span> <span class="keywordtype">double</span>[<a class="code" href="classCLTreeMaker.html#43e9b8c661dd8f84f96818f7282411bf">_resolution</a>];
<a name="l00691"></a>00691 
<a name="l00692"></a>00692   <a class="code" href="classCLTreeMaker.html#7f06740d4a5b7d1dd23786e74c4433d9">_chi2Int_4</a>[0] = 0;  <span class="comment">// first entry is 0</span>
<a name="l00693"></a>00693   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classCLTreeMaker.html#43e9b8c661dd8f84f96818f7282411bf">_resolution</a>; ++i){  <span class="comment">// integrate from next entry</span>
<a name="l00694"></a>00694     <span class="keywordtype">double</span> chi2_4 = i * <a class="code" href="classCLTreeMaker.html#74321547633c186fadc1604a83391a00">_chi2Step_4</a>;          <span class="comment">// chi^2 for this entry</span>
<a name="l00695"></a>00695     <span class="keywordtype">double</span> dist = <a class="code" href="classCLTreeMaker.html#772721049246225bd1b2cb6aed415953">chi2dist</a>(chi2_4, 4);          <span class="comment">// the chi^2 distribution:</span>
<a name="l00696"></a>00696     <a class="code" href="classCLTreeMaker.html#7f06740d4a5b7d1dd23786e74c4433d9">_chi2Int_4</a>[i] = dist * <a class="code" href="classCLTreeMaker.html#74321547633c186fadc1604a83391a00">_chi2Step_4</a> + <a class="code" href="classCLTreeMaker.html#7f06740d4a5b7d1dd23786e74c4433d9">_chi2Int_4</a>[i-1];   <span class="comment">// the integral </span>
<a name="l00697"></a>00697   }
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 
<a name="l00701"></a><a class="code" href="classCLTreeMaker.html#100c24d9686e1743d4c5cbb476257505">00701</a> <span class="keywordtype">double</span> <a class="code" href="classCLTreeMaker.html#100c24d9686e1743d4c5cbb476257505">CLTreeMaker::lookupCL_4</a>(<span class="keywordtype">double</span> chi2)<span class="keyword"> const </span>{
<a name="l00702"></a>00702   <span class="comment">// Find the entry in the nDOF=4 table corresponding to this chi^2:</span>
<a name="l00703"></a>00703   <span class="keywordtype">int</span> i = (int)(chi2 / <a class="code" href="classCLTreeMaker.html#74321547633c186fadc1604a83391a00">_chi2Step_4</a>);
<a name="l00704"></a>00704   <span class="keywordflow">if</span> (i &lt; <a class="code" href="classCLTreeMaker.html#43e9b8c661dd8f84f96818f7282411bf">_resolution</a>) {
<a name="l00705"></a>00705     <span class="keywordflow">return</span> <a class="code" href="classCLTreeMaker.html#7f06740d4a5b7d1dd23786e74c4433d9">_chi2Int_4</a>[i];
<a name="l00706"></a>00706   }
<a name="l00707"></a>00707   <span class="keywordflow">return</span> 1.0;  <span class="comment">// chi2 was so big that the integral is 1</span>
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710   
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Nov 11 16:23:43 2007 for BToDKTo3piK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
